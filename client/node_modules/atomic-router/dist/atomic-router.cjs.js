function e(e){void 0===e&&(e={});var r=effector.createEffect((e=>{var r=e.replace;return{params:e.params||{},query:e.query||{},replace:void 0!==r&&r}}),{name:"navigateFx",sid:"c2qlao"}),a=effector.attach({and:{effect:r,mapParams:e=>({params:e||{},query:{}})},or:{name:"openFx",sid:"am04as"}}),t=effector.createStore(!1,{name:"$isOpened",sid:"-8u29di"}),o=effector.createStore({},{name:"$params",sid:"6sxdf"}),n=effector.createStore({},{name:"$query",sid:"tylje5"}),s=effector.createEvent({name:"opened",sid:"fafqk0"}),i=effector.createEvent({name:"updated",sid:"66vs1s"}),c=effector.createEvent({name:"closed",sid:"-wbq1n3"});return t.on(s,(()=>!0)).on(c,(()=>!1)),o.on(s,((e,r)=>r.params)).on(i,((e,r)=>r.params)),n.on(s,((e,r)=>r.query)).on(i,((e,r)=>r.query)),effector.split({and:[{source:r.doneData,match:t.map((e=>e?'updated':'opened')),cases:{opened:s,updated:i}}],or:{sid:"3j56hf"}}),{$isOpened:t,$params:o,$query:n,opened:s,updated:i,closed:c,navigate:r,open:a,kind:m.ROUTE,settings:{derived:Boolean(e.filter)}}}function r(e,r){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((r=>Object.getOwnPropertyDescriptor(e,r).enumerable))),a.push.apply(a,t)}return a}function a(e){for(var a=1;a<arguments.length;a++){var o=null!=arguments[a]?arguments[a]:{};a%2?r(Object(o),!0).forEach((r=>{t(e,r,o[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((r=>{Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(o,r))}))}return e}function t(e,r,a){return r in e?Object.defineProperty(e,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[r]=a,e}function o(e,r){(null==r||r>e.length)&&(r=e.length);for(var a=0,t=new Array(r);a<r;a++)t[a]=e[a];return t}function n(e,r){var it="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(it)return(it=it.call(e)).next.bind(it);if(Array.isArray(e)||(it=((e,r)=>{if(e){if("string"==typeof e)return o(e,r);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?o(e,r):void 0}})(e))||r&&e&&"number"==typeof e.length){it&&(e=it);var a=0;return()=>a>=e.length?{done:!0}:{done:!1,value:e[a++]}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(var a in e)if(""+e[a]!=""+r[a])return!1;return!0}function i(e){var r,a=e.params,t=e.query,o=e.serialize,n=p.compile(e.pathCreator)(a),s=null!==(r=null==o?void 0:o.write(t))&&void 0!==r?r:new URLSearchParams(t);return n+(Object.keys(t).length?"?"+s:'')}function c(e){var r=e.actualPath,a=p.match(e.pathCreator.replace('://','\\://'))((e=>{if(e.match(/^[a-z0-9]+\:\/\//i))return e;var r=new URL("http://_"+e);return[r.pathname,r.hash].join('')})(r));return a?{matches:!0,params:a.params}:{matches:!1}}function d(e){if(!e)throw new Error('[Routing] No history provided')}function l(e){return e.map((e=>!e))}function u(e){return effector.is.store(e,{sid:"b1hcct"})?e:effector.createStore(e,{sid:"-cvms36"})}Object.defineProperty(exports,'__esModule',{value:!0});var effector=require('effector'),p=require('path-to-regexp'),m={ROUTE:Symbol()},f=()=>({$query:effector.createStore({},{and:{updateFilter:(e,r)=>!s(r,e)},name:"$query",sid:"z22f3o"}),back:effector.createEvent({name:"back",sid:"lqciue"}),forward:effector.createEvent({name:"forward",sid:"-5dfdts"})}),v=e=>'object'==typeof e&&null!==e&&'kind'in e&&e.kind===m.ROUTE,h=effector.createEffect((e=>(d(e.history),e.history[e.method](e.path,{}),e)),{name:"historyPushFx",sid:"-w0no5y"}),y=effector.createEffect((e=>(d(e),e.back(),e)),{name:"historyBackFx",sid:"-ny8vwp"}),g=effector.createEffect((e=>(d(e),e.forward(),e)),{name:"historyForwardFx",sid:"88oqi4"}),b=e=>r=>{var a=r.find((r=>r.routeObj.route===e.route));if(a)return{params:a.params,query:a.query}},O={all:{irrelevant:!0,empty:!0,preserve:[]},default:{irrelevant:!1,empty:!0,preserve:[]},none:{irrelevant:!1,empty:!1,preserve:[]}};exports.Kind=m,exports.buildPath=i,exports.chainRoute=r=>{var a=(r=>{var a={};if(effector.withFactory({sid:"-vuorye",fn:()=>v(r),name:"none",method:"isRoute"}))return Object.assign(a,{route:r,chainedRoute:effector.withFactory({sid:"-x3jlk0",fn:()=>e(),name:"chainedRoute",method:"createRoute"}),beforeOpen:effector.createEvent({name:"beforeOpen",sid:"2i9mdy"}),openOn:effector.merge([r.opened,r.closed],{name:"openOn",sid:"-n9uh0c"}),cancelOn:effector.merge([effector.createEvent({name:"cancelOn",sid:"r6ceph"})],{name:"cancelOn",sid:"r6ce1d"})}),a;var t=r;if(Object.assign(a,{route:t.route,chainedRoute:t.chainedRoute||effector.withFactory({sid:"-if59ok",fn:()=>e(),name:"chainedRoute",method:"createRoute"}),beforeOpen:effector.is.unit(t.beforeOpen)?t.beforeOpen:effector.attach({and:t.beforeOpen,or:{name:"beforeOpen",sid:"-xdumjk"}})}),effector.is.effect(a.beforeOpen,{sid:"-qylloz"}))return Object.assign(a,{openOn:t.openOn||a.beforeOpen.doneData,cancelOn:t.cancelOn||a.beforeOpen.failData}),a;var o=r;return Object.assign(a,{openOn:effector.sample({and:[{clock:o.openOn}],or:{name:"openOn",sid:"-92mmrn"}}),cancelOn:effector.sample({and:[{clock:o.cancelOn||effector.createEvent({name:"clock",sid:"-53qs2n"})}],or:{name:"cancelOn",sid:"-m0jt12"}})}),a})(r),t=a.route,o=a.chainedRoute,n=a.beforeOpen,s=a.openOn,i=a.cancelOn,c=effector.createStore({},{name:"$params",sid:"ahwukb"}),d=effector.createStore({},{name:"$query",sid:"-urele3"}),l=effector.combine({and:[effector.combine({and:[[t.$params,t.$query]],or:{name:"and",sid:"3v6jcf"}}),effector.combine({and:[[c,d]],or:{name:"and",sid:"3vqbxs"}}),(e,r)=>e[0]===r[0]&&e[1]===r[1]],or:{name:"$hasSameParams",sid:"-xzy23v"}}),u=effector.sample({and:[{clock:[t.opened,t.updated]}],or:{name:"routeOpened",sid:"-gtwxmc"}});effector.sample({and:[{clock:u,target:n}],or:{sid:"-noxmt5"}}),c.on(u,((e,r)=>r.params)),d.on(u,((e,r)=>r.query));var p=effector.guard({and:[{clock:s,source:{params:c,query:d},filter:l}],or:{name:"chainedRouteResolved",sid:"-mwemeb"}});effector.sample({and:[{clock:p,target:o.navigate}],or:{sid:"-n6sf88"}});var m=effector.merge([t.closed,i],{name:"aborted",sid:"utn0jm"});return c.reset(m),d.reset(m),effector.sample({and:[{clock:m,target:o.closed}],or:{sid:"-mqalfe"}}),o},exports.createHistoryRouter=e=>{var r=e.base,t=e.routes,o=e.notFoundRoute,d=e.hydrate,u=e.serialize,p=e.controls,m=void 0===p?effector.withFactory({sid:"d2qzob",fn:()=>f(),name:"controls",method:"createRouterControls"}):p,O=((e,r)=>{void 0===r&&(r='');for(var t,o=[],s=()=>{var e,r=t.value;Array.isArray(r.route)?(e=o).push.apply(e,r.route.map((e=>a(a({},r),{},{route:e})))):o.push(r)},i=n(e);!(t=i()).done;)s();o=o.map((e=>a(a({},e),{},{path:""+r+e.path})));for(var c,d=[],l=[],u=n(o);!(c=u()).done;){var p=c.value;p.route.settings.derived?d.push(p):l.push(p)}if(d.length)for(var m,f=n(d);!(m=f()).done;)console.error("createHistoryRouter: "+m.value.path+" uses derived route. This won't work");return l})(t,r),k=effector.createEvent({name:"setHistory",sid:"9zwyxu"}),q=effector.createEvent({name:"navigateFromRouteTriggered",sid:"soge6d"}),j=effector.createEvent({name:"historyUpdated",sid:"-x4474u"}),w=effector.createEvent({name:"recalculateTriggered",sid:"-ykrhlj"}),$=effector.createEvent({name:"recalculated",sid:"aeh4sf"}),x=effector.createEvent({name:"routesMatched",sid:"2rfqt6"}),R=effector.createEvent({name:"routesMismatched",sid:"71hypl"}),E=effector.createEvent({name:"routeNotFound",sid:"avqxzu"}),S=effector.createEvent({name:"initialized",sid:"du6f0f"}),P=effector.createStore('',{name:"$path",sid:"wz8cwv"}),F=effector.createStore({},{and:{name:'historyRouter.$query',updateFilter:(e,r)=>!s(e,r)},name:"$query",sid:"tkdilp"}),z=effector.createStore([],{and:{serialize:'ignore'},name:"$activeRoutes",sid:"9ljm7u"}),U=effector.createStore(null,{and:{serialize:'ignore'},name:"$history",sid:"g4i7nj"}),A=effector.createStore(!1,{name:"$isFirstCheckPassed",sid:"9r108x"}),C=effector.createStore(!1,{name:"$isRouteNavigateInProgress",sid:"a1vtrl"}),D=effector.attach({and:{source:U,effect:(e,r)=>h(a({history:e},r))},or:{name:"pushFx",sid:"qm76ov"}}),H=effector.attach({and:{source:U,effect:e=>{var r=j;try{r=effector.scopeBind(j)}catch(e){}return e.listen((()=>{r()})),!0}},or:{name:"subscribeHistoryFx",sid:"-b12mlt"}}),T=effector.sample({and:[{clock:d?[j]:[j,H.done],source:U,filter:Boolean,fn:e=>{var r;return{path:e.location.pathname,query:null!==(r=null==u?void 0:u.read(e.location.search))&&void 0!==r?r:Object.fromEntries(new URLSearchParams(e.location.search))}}}],or:{name:"historyUpdatedParsed",sid:"-rhkauu"}}),Q=effector.sample({and:[{clock:T,source:{path:P,query:F},filter:(e,r)=>r.path!==e.path||!s(r.query,e.query),fn:(e,r)=>r}],or:{name:"historyUpdateTriggered",sid:"-pbyg2j"}});U.on(k,((e,r)=>r)),effector.sample({and:[{clock:U,target:H}],or:{sid:"-pwl7u3"}}),effector.sample({and:[{clock:Q,source:U,filter:Boolean,fn:e=>{var r,a=null==e?void 0:e.location.hash;return{path:null==e?void 0:e.location.pathname,query:null!==(r=null==u?void 0:u.read(null==e?void 0:e.location.search))&&void 0!==r?r:Object.fromEntries(new URLSearchParams(null==e?void 0:e.location.search)),hash:a}},target:w}],or:{sid:"-ptu8va"}});for(var B,I=n(O);!(B=I()).done;){var L=B.value,M=x.filterMap(b(L)),N=R.filterMap(b(L)),_={opened:effector.sample({and:[{clock:M,filter:l(L.route.$isOpened)}],or:{name:"opened",sid:"-vfmdab"}}),updated:effector.sample({and:[{clock:M,filter:L.route.$isOpened}],or:{name:"updated",sid:"-2uhvx2"}}),closed:effector.sample({and:[{clock:N,filter:L.route.$isOpened}],or:{name:"closed",sid:"jc9588"}})};effector.sample({and:[{clock:_.updated,source:[L.route.$params,L.route.$query],filter:(e,r)=>{var a=e[1];return!s(e[0],r.params)||!s(a,r.query)},fn:(e,r)=>r,target:L.route.updated}],or:{sid:"-ny7ju5"}}),effector.sample({and:[{clock:_.opened,filter:l(C),target:L.route.opened}],or:{sid:"-ngm4ul"}}),effector.sample({and:[{clock:_.closed,target:L.route.closed}],or:{sid:"-d2q1d1"}})}for(var K,G=()=>{var e=K.value;effector.sample({and:[{clock:e.route.navigate.doneData,fn:r=>{var a=r.replace;return{route:e,params:r.params,query:r.query,replace:null!=a&&a}},target:q}],or:{sid:"-cm87k7"}})},J=n(O);!(K=J()).done;)G();C.on(q,(()=>!0)),effector.sample({and:[{clock:q,fn:e=>{var r=e.params,a=e.query,t=e.replace;return{path:i({pathCreator:e.route.path,params:r,query:a,serialize:u}),params:r,query:a,method:t?'replace':'push'}},target:D}],or:{sid:"-c2zeua"}}),C.reset([x,R]),effector.sample({and:[{clock:w,fn:e=>{for(var r,a=e.path,t=e.query,o=e.hash,s=[],i=[],d=n(O);!(r=d()).done;){var l=r.value,u=l.path.includes('#')?""+a+o:""+a,p=c({pathCreator:l.path,actualPath:u});(p.matches?s:i).push({routeObj:l,params:p.params,query:t})}return i.forEach(((e,r)=>{s.some((r=>r.routeObj.route===e.routeObj.route))&&i.splice(r,1)})),{matching:s,mismatching:i.filter(Boolean),path:a,query:t}},target:$}],or:{sid:"-ar5b7v"}}),P.on(Q,((e,r)=>r.path)),F.on(Q,((e,r)=>r.query));var V=$.map((e=>e.matching));return effector.sample({and:[{clock:V,filter:e=>e.length>0,target:x}],or:{sid:"1l4g7x"}}),effector.sample({and:[{clock:$.map((e=>e.mismatching)),filter:e=>e.length>0,target:R}],or:{sid:"1zyw8o"}}),z.on($,((e,r)=>r.matching.map((e=>e.routeObj.route)))),effector.sample({and:[{clock:V,filter:e=>0===e.length,target:E}],or:{sid:"2hkb88"}}),effector.withFactory({sid:"2kv2vu",fn:()=>v(o),name:"none",method:"isRoute"})&&(effector.sample({and:[{clock:E,source:F,filter:o.$isOpened,fn:e=>({query:e,params:{}}),target:o.updated}],or:{sid:"2levfh"}}),effector.sample({and:[{clock:E,source:{query:F,isOpened:o.$isOpened},filter:e=>!e.isOpened,fn:e=>({query:e.query,params:{}}),target:o.opened}],or:{sid:"31cwmy"}}),effector.sample({and:[{clock:V,source:o.$isOpened,filter:(e,r)=>e&&r.length>0,target:o.closed}],or:{sid:"3haxuf"}})),effector.sample({and:[{clock:m.back,source:U,target:y}],or:{sid:"3xsrlj"}}),effector.sample({and:[{clock:m.forward,source:U,target:g}],or:{sid:"413j5p"}}),effector.sample({and:[{clock:F,source:{controlsQuery:m.$query,localQuery:F},filter:e=>!s(e.controlsQuery,e.localQuery),fn:e=>e.localQuery,target:m.$query}],or:{sid:"4ghrrt"}}),effector.sample({and:[{clock:m.$query,source:{path:P,localQuery:F,isNavigateInProgress:C,realHistory:U},filter:(e,r)=>{var a,t,o,n=e.localQuery,i=e.isNavigateInProgress,c=e.realHistory,d=null!==(a=null==u?void 0:u.read(null!==(t=null==c?void 0:c.location.search)&&void 0!==t?t:''))&&void 0!==a?a:Object.fromEntries(new URLSearchParams(null!==(o=null==c?void 0:c.location.search)&&void 0!==o?o:''));return i||!s(r,d)||!s(n,r)},fn:(e,r)=>{var a,t=e.path,o=null!==(a=null==u?void 0:u.write(r))&&void 0!==a?a:new URLSearchParams(r);return{path:t+(o?"?"+o:''),params:{},query:r,method:'push'}},target:D}],or:{sid:"4wzlkn"}}),effector.sample({and:[{clock:$,source:{activeRoutes:z,path:P,query:F},filter:A.map((e=>!e)),target:S}],or:{sid:"gbpwte"}}),A.on(S,(()=>!0)).reset(U),{$path:P,$activeRoutes:z,$history:U,setHistory:k,$query:F,back:m.back,forward:m.forward,push:D,routes:O,initialized:S,routeNotFound:E}},exports.createRoute=e,exports.createRouterControls=f,exports.isRoute=v,exports.matchPath=c,exports.querySync=e=>{var r,t,o,s=null!==(r=null===(t=e.route)||void 0===t?void 0:t.$isOpened)&&void 0!==r?r:effector.createStore(!0,{name:"$isOpened",sid:"-ubx3p"}),i=effector.combine({and:[e.source],or:{name:"$source",sid:"-3rrhte"}}),c=null!==(o=e.clock)&&void 0!==o?o:i,d='cleanup'in e?'boolean'==typeof e.cleanup?O[e.cleanup?'all':'none']:a(a({},O.default),e.cleanup):O.default,l=effector.sample({and:[{clock:e.controls.$query,filter:s}],or:{name:"queryUpdatedFromHistory",sid:"8lf3wv"}});effector.sample({and:[{clock:c,source:effector.combine({and:[[i,e.controls.$query]],or:{name:"source",sid:"-3pgs50"}}),filter:s,fn:e=>{var r=e[0],t=e[1],o={};if(d.irrelevant)for(var s,i=n(d.preserve);!(s=i()).done;){var c=s.value;c in t&&(o[c]=t[c])}else o=a({},t);for(var l in r)o[l]=r[l];if(d.empty)for(var u in r)d.preserve.includes(u)||o[u]||delete o[u];return o},target:e.controls.$query}],or:{sid:"fuzb5g"}});var u=r=>{var a=e.source[r];a.on(l,((e,t)=>{var o;return null!==(o=t[r])&&void 0!==o?o:a.defaultState}))};for(var p in e.source)u(p)},exports.redirect=e=>{var r=e.clock?effector.sample({and:[{clock:e.clock}],or:{name:"clock",sid:"-ek44ri"}}):effector.createEvent({name:"clock",sid:"-ejkc65"}),a=u(e.params||{}),t=u(e.query||{}),o=u(e.replace||!1);return effector.sample({and:[{clock:r,source:{params:a,query:t,replace:o},fn:(e,r)=>{var a=e.params,t=e.query,o=e.replace;return{params:'function'==typeof a?a(r):a,query:'function'==typeof t?t(r):t,replace:'function'==typeof o?o(r):o}},target:e.route.navigate}],or:{sid:"ai8jf5"}}),r};
//# sourceMappingURL=atomic-router.cjs.js.map
