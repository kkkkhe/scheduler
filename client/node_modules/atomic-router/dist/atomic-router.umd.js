((e,r)=>{'object'==typeof exports&&'undefined'!=typeof module?r(exports,require('effector')):'function'==typeof define&&define.amd?define(['exports','effector'],r):r((e='undefined'!=typeof globalThis?globalThis:e||self).atomicRouter={},e.effector)})(this,((e,effector)=>{function r(e){void 0===e&&(e={});var r=effector.createEffect((e=>{var r=e.replace;return{params:e.params||{},query:e.query||{},replace:void 0!==r&&r}}),{name:"navigateFx",sid:"c2qlao"}),a=effector.attach({and:{effect:r,mapParams:e=>({params:e||{},query:{}})},or:{name:"openFx",sid:"am04as"}}),t=effector.createStore(!1,{name:"$isOpened",sid:"-8u29di"}),n=effector.createStore({},{name:"$params",sid:"6sxdf"}),o=effector.createStore({},{name:"$query",sid:"tylje5"}),i=effector.createEvent({name:"opened",sid:"fafqk0"}),c=effector.createEvent({name:"updated",sid:"66vs1s"}),s=effector.createEvent({name:"closed",sid:"-wbq1n3"});return t.on(i,(()=>!0)).on(s,(()=>!1)),n.on(i,((e,r)=>r.params)).on(c,((e,r)=>r.params)),o.on(i,((e,r)=>r.query)).on(c,((e,r)=>r.query)),effector.split({and:[{source:r.doneData,match:t.map((e=>e?'updated':'opened')),cases:{opened:i,updated:c}}],or:{sid:"3j56hf"}}),{$isOpened:t,$params:n,$query:o,opened:i,updated:c,closed:s,navigate:r,open:a,kind:g.ROUTE,settings:{derived:Boolean(e.filter)}}}function a(e,r){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((r=>Object.getOwnPropertyDescriptor(e,r).enumerable))),a.push.apply(a,t)}return a}function t(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?a(Object(t),!0).forEach((r=>{n(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((r=>{Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function n(e,r,a){return r in e?Object.defineProperty(e,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[r]=a,e}function o(e,r){(null==r||r>e.length)&&(r=e.length);for(var a=0,t=new Array(r);a<r;a++)t[a]=e[a];return t}function i(e,r){var it="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(it)return(it=it.call(e)).next.bind(it);if(Array.isArray(e)||(it=((e,r)=>{if(e){if("string"==typeof e)return o(e,r);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?o(e,r):void 0}})(e))||r&&e&&"number"==typeof e.length){it&&(e=it);var a=0;return()=>a>=e.length?{done:!0}:{done:!1,value:e[a++]}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(var a in e)if(""+e[a]!=""+r[a])return!1;return!0}function s(e,r){void 0===r&&(r={});for(var a=(e=>{for(var r=[],a=0;a<e.length;){var t=e[a];if("*"!==t&&"+"!==t&&"?"!==t)if("\\"!==t)if("{"!==t)if("}"!==t)if(":"!==t)if("("!==t)r.push({type:"CHAR",index:a,value:e[a++]});else{var n=1,o="";if("?"===e[c=a+1])throw new TypeError("Pattern cannot start with \"?\" at ".concat(c));for(;c<e.length;)if("\\"!==e[c]){if(")"===e[c]){if(0==--n){c++;break}}else if("("===e[c]&&(n++,"?"!==e[c+1]))throw new TypeError("Capturing groups are not allowed at ".concat(c));o+=e[c++]}else o+=e[c++]+e[c++];if(n)throw new TypeError("Unbalanced pattern at ".concat(a));if(!o)throw new TypeError("Missing pattern at ".concat(a));r.push({type:"PATTERN",index:a,value:o}),a=c}else{for(var i="",c=a+1;c<e.length;){var s=e.charCodeAt(c);if(!(s>=48&&s<=57||s>=65&&s<=90||s>=97&&s<=122||95===s))break;i+=e[c++]}if(!i)throw new TypeError("Missing parameter name at ".concat(a));r.push({type:"NAME",index:a,value:i}),a=c}else r.push({type:"CLOSE",index:a,value:e[a++]});else r.push({type:"OPEN",index:a,value:e[a++]});else r.push({type:"ESCAPED_CHAR",index:a++,value:e[a++]});else r.push({type:"MODIFIER",index:a,value:e[a++]})}return r.push({type:"END",index:a,value:""}),r})(e),t=r.prefixes,n=void 0===t?"./":t,o="[^".concat(u(r.delimiter||"/#?"),"]+?"),i=[],c=0,s=0,d="",l=e=>{if(s<a.length&&a[s].type===e)return a[s++].value},p=e=>{var r=l(e);if(void 0!==r)return r;var t=a[s],n=t.index;throw new TypeError("Unexpected ".concat(t.type," at ").concat(n,", expected ").concat(e))},f=()=>{for(var e,r="";e=l("CHAR")||l("ESCAPED_CHAR");)r+=e;return r};s<a.length;){var m=l("CHAR"),v=l("NAME"),h=l("PATTERN");if(v||h)-1===n.indexOf(g=m||"")&&(d+=g,g=""),d&&(i.push(d),d=""),i.push({name:v||c++,prefix:g,suffix:"",pattern:h||o,modifier:l("MODIFIER")||""});else{var y=m||l("ESCAPED_CHAR");if(y)d+=y;else if(d&&(i.push(d),d=""),l("OPEN")){var g=f(),b=l("NAME")||"",O=l("PATTERN")||"",w=f();p("CLOSE"),i.push({name:b||(O?c++:""),pattern:b&&!O?o:O,prefix:g,suffix:w,modifier:l("MODIFIER")||""})}else p("END")}}return i}function d(e,r){var a=[];return((e,r,a)=>{void 0===a&&(a={});var t=a.decode,n=void 0===t?e=>e:t;return a=>{var t=e.exec(a);if(!t)return!1;for(var o=t[0],i=t.index,c=Object.create(null),s=e=>{if(void 0===t[e])return"continue";var a=r[e-1];c[a.name]="*"===a.modifier||"+"===a.modifier?t[e].split(a.prefix+a.suffix).map((e=>n(e,a))):n(t[e],a)},d=1;d<t.length;d++)s(d);return{path:o,index:i,params:c}}})(p(e,a,r),a,r)}function u(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function l(e){return e&&e.sensitive?"":"i"}function p(e,r,a){return e instanceof RegExp?((e,r)=>{if(!r)return e;for(var a=/\((?:\?<(.*?)>)?(?!\?)/g,t=0,n=a.exec(e.source);n;)r.push({name:n[1]||t++,prefix:"",suffix:"",modifier:"",pattern:""}),n=a.exec(e.source);return e})(e,r):Array.isArray(e)?((e,r,a)=>{var t=e.map((e=>p(e,r,a).source));return new RegExp("(?:".concat(t.join("|"),")"),l(a))})(e,r,a):((e,r,a)=>((e,r,a)=>{void 0===a&&(a={});for(var t=a.strict,n=void 0!==t&&t,o=a.start,i=void 0===o||o,c=a.end,s=void 0===c||c,d=a.encode,p=void 0===d?e=>e:d,f=a.delimiter,m=void 0===f?"/#?":f,v=a.endsWith,h="[".concat(u(void 0===v?"":v),"]|$"),y="[".concat(u(m),"]"),g=i?"^":"",b=0,O=e;b<O.length;b++){var w=O[b];if("string"==typeof w)g+=u(p(w));else{var E=u(p(w.prefix)),k=u(p(w.suffix));if(w.pattern)if(r&&r.push(w),E||k)if("+"===w.modifier||"*"===w.modifier){var x="*"===w.modifier?"?":"";g+="(?:".concat(E,"((?:").concat(w.pattern,")(?:").concat(k).concat(E,"(?:").concat(w.pattern,"))*)").concat(k,")").concat(x)}else g+="(?:".concat(E,"(").concat(w.pattern,")").concat(k,")").concat(w.modifier);else g+="+"===w.modifier||"*"===w.modifier?"((?:".concat(w.pattern,")").concat(w.modifier,")"):"(".concat(w.pattern,")").concat(w.modifier);else g+="(?:".concat(E).concat(k,")").concat(w.modifier)}}if(s)n||(g+="".concat(y,"?")),g+=a.endsWith?"(?=".concat(h,")"):"$";else{var q=e[e.length-1],j="string"==typeof q?y.indexOf(q[q.length-1])>-1:void 0===q;n||(g+="(?:".concat(y,"(?=").concat(h,"))?")),j||(g+="(?=".concat(y,"|").concat(h,")"))}return new RegExp(g,l(a))})(s(e,a),r,a))(e,r,a)}function f(e){var r,a=e.params,t=e.query,n=e.serialize,o=((e,r)=>((e,r)=>{void 0===r&&(r={});var a=l(r),t=r.encode,n=void 0===t?e=>e:t,o=r.validate,i=void 0===o||o,c=e.map((e=>{if("object"==typeof e)return new RegExp("^(?:".concat(e.pattern,")$"),a)}));return r=>{for(var a="",t=0;t<e.length;t++){var o=e[t];if("string"!=typeof o){var s=r?r[o.name]:void 0,d="?"===o.modifier||"*"===o.modifier,u="*"===o.modifier||"+"===o.modifier;if(Array.isArray(s)){if(!u)throw new TypeError("Expected \"".concat(o.name,"\" to not repeat, but got an array"));if(0===s.length){if(d)continue;throw new TypeError("Expected \"".concat(o.name,"\" to not be empty"))}for(var l=0;l<s.length;l++){var p=n(s[l],o);if(i&&!c[t].test(p))throw new TypeError("Expected all \"".concat(o.name,"\" to match \"").concat(o.pattern,"\", but got \"").concat(p,"\""));a+=o.prefix+p+o.suffix}}else if("string"!=typeof s&&"number"!=typeof s){if(!d){var f=u?"an array":"a string";throw new TypeError("Expected \"".concat(o.name,"\" to be ").concat(f))}}else{if(p=n(String(s),o),i&&!c[t].test(p))throw new TypeError("Expected \"".concat(o.name,"\" to match \"").concat(o.pattern,"\", but got \"").concat(p,"\""));a+=o.prefix+p+o.suffix}}else a+=o}return a}})(s(e,r),r))(e.pathCreator)(a),i=null!==(r=null==n?void 0:n.write(t))&&void 0!==r?r:new URLSearchParams(t);return o+(Object.keys(t).length?"?"+i:'')}function m(e){var r=e.actualPath,a=d((e=>e.replace('://','\\://'))(e.pathCreator))((e=>{if(e.match(/^[a-z0-9]+\:\/\//i))return e;var r=new URL("http://_"+e);return[r.pathname,r.hash].join('')})(r));return a?{matches:!0,params:a.params}:{matches:!1}}function v(e){if(!e)throw new Error('[Routing] No history provided')}function h(e){return e.map((e=>!e))}function y(e){return effector.is.store(e,{sid:"b1hcct"})?e:effector.createStore(e,{sid:"-cvms36"})}var g={ROUTE:Symbol()},b=()=>({$query:effector.createStore({},{and:{updateFilter:(e,r)=>!c(r,e)},name:"$query",sid:"z22f3o"}),back:effector.createEvent({name:"back",sid:"lqciue"}),forward:effector.createEvent({name:"forward",sid:"-5dfdts"})}),O=e=>'object'==typeof e&&null!==e&&'kind'in e&&e.kind===g.ROUTE,w=effector.createEffect((e=>(v(e.history),e.history[e.method](e.path,{}),e)),{name:"historyPushFx",sid:"-w0no5y"}),E=effector.createEffect((e=>(v(e),e.back(),e)),{name:"historyBackFx",sid:"-ny8vwp"}),k=effector.createEffect((e=>(v(e),e.forward(),e)),{name:"historyForwardFx",sid:"88oqi4"}),x=e=>r=>{var a=r.find((r=>r.routeObj.route===e.route));if(a)return{params:a.params,query:a.query}},q={all:{irrelevant:!0,empty:!0,preserve:[]},default:{irrelevant:!1,empty:!0,preserve:[]},none:{irrelevant:!1,empty:!1,preserve:[]}};e.Kind=g,e.buildPath=f,e.chainRoute=e=>{var a=(e=>{var a={};if(effector.withFactory({sid:"-vuorye",fn:()=>O(e),name:"none",method:"isRoute"}))return Object.assign(a,{route:e,chainedRoute:effector.withFactory({sid:"-x3jlk0",fn:()=>r(),name:"chainedRoute",method:"createRoute"}),beforeOpen:effector.createEvent({name:"beforeOpen",sid:"2i9mdy"}),openOn:effector.merge([e.opened,e.closed],{name:"openOn",sid:"-n9uh0c"}),cancelOn:effector.merge([effector.createEvent({name:"cancelOn",sid:"r6ceph"})],{name:"cancelOn",sid:"r6ce1d"})}),a;var t=e;if(Object.assign(a,{route:t.route,chainedRoute:t.chainedRoute||effector.withFactory({sid:"-if59ok",fn:()=>r(),name:"chainedRoute",method:"createRoute"}),beforeOpen:effector.is.unit(t.beforeOpen)?t.beforeOpen:effector.attach({and:t.beforeOpen,or:{name:"beforeOpen",sid:"-xdumjk"}})}),effector.is.effect(a.beforeOpen,{sid:"-qylloz"}))return Object.assign(a,{openOn:t.openOn||a.beforeOpen.doneData,cancelOn:t.cancelOn||a.beforeOpen.failData}),a;var n=e;return Object.assign(a,{openOn:effector.sample({and:[{clock:n.openOn}],or:{name:"openOn",sid:"-92mmrn"}}),cancelOn:effector.sample({and:[{clock:n.cancelOn||effector.createEvent({name:"clock",sid:"-53qs2n"})}],or:{name:"cancelOn",sid:"-m0jt12"}})}),a})(e),t=a.route,n=a.chainedRoute,o=a.beforeOpen,i=a.openOn,c=a.cancelOn,s=effector.createStore({},{name:"$params",sid:"ahwukb"}),d=effector.createStore({},{name:"$query",sid:"-urele3"}),u=effector.combine({and:[effector.combine({and:[[t.$params,t.$query]],or:{name:"and",sid:"3v6jcf"}}),effector.combine({and:[[s,d]],or:{name:"and",sid:"3vqbxs"}}),(e,r)=>e[0]===r[0]&&e[1]===r[1]],or:{name:"$hasSameParams",sid:"-xzy23v"}}),l=effector.sample({and:[{clock:[t.opened,t.updated]}],or:{name:"routeOpened",sid:"-gtwxmc"}});effector.sample({and:[{clock:l,target:o}],or:{sid:"-noxmt5"}}),s.on(l,((e,r)=>r.params)),d.on(l,((e,r)=>r.query));var p=effector.guard({and:[{clock:i,source:{params:s,query:d},filter:u}],or:{name:"chainedRouteResolved",sid:"-mwemeb"}});effector.sample({and:[{clock:p,target:n.navigate}],or:{sid:"-n6sf88"}});var f=effector.merge([t.closed,c],{name:"aborted",sid:"utn0jm"});return s.reset(f),d.reset(f),effector.sample({and:[{clock:f,target:n.closed}],or:{sid:"-mqalfe"}}),n},e.createHistoryRouter=e=>{var r=e.base,a=e.routes,n=e.notFoundRoute,o=e.hydrate,s=e.serialize,d=e.controls,u=void 0===d?effector.withFactory({sid:"d2qzob",fn:()=>b(),name:"controls",method:"createRouterControls"}):d,l=((e,r)=>{void 0===r&&(r='');for(var a,n=[],o=()=>{var e,r=a.value;Array.isArray(r.route)?(e=n).push.apply(e,r.route.map((e=>t(t({},r),{},{route:e})))):n.push(r)},c=i(e);!(a=c()).done;)o();n=n.map((e=>t(t({},e),{},{path:""+r+e.path})));for(var s,d=[],u=[],l=i(n);!(s=l()).done;){var p=s.value;p.route.settings.derived?d.push(p):u.push(p)}if(d.length)for(var f,m=i(d);!(f=m()).done;)console.error("createHistoryRouter: "+f.value.path+" uses derived route. This won't work");return u})(a,r),p=effector.createEvent({name:"setHistory",sid:"9zwyxu"}),v=effector.createEvent({name:"navigateFromRouteTriggered",sid:"soge6d"}),y=effector.createEvent({name:"historyUpdated",sid:"-x4474u"}),g=effector.createEvent({name:"recalculateTriggered",sid:"-ykrhlj"}),q=effector.createEvent({name:"recalculated",sid:"aeh4sf"}),j=effector.createEvent({name:"routesMatched",sid:"2rfqt6"}),R=effector.createEvent({name:"routesMismatched",sid:"71hypl"}),$=effector.createEvent({name:"routeNotFound",sid:"avqxzu"}),P=effector.createEvent({name:"initialized",sid:"du6f0f"}),S=effector.createStore('',{name:"$path",sid:"wz8cwv"}),A=effector.createStore({},{and:{name:'historyRouter.$query',updateFilter:(e,r)=>!c(e,r)},name:"$query",sid:"tkdilp"}),T=effector.createStore([],{and:{serialize:'ignore'},name:"$activeRoutes",sid:"9ljm7u"}),F=effector.createStore(null,{and:{serialize:'ignore'},name:"$history",sid:"g4i7nj"}),C=effector.createStore(!1,{name:"$isFirstCheckPassed",sid:"9r108x"}),z=effector.createStore(!1,{name:"$isRouteNavigateInProgress",sid:"a1vtrl"}),D=effector.attach({and:{source:F,effect:(e,r)=>w(t({history:e},r))},or:{name:"pushFx",sid:"qm76ov"}}),N=effector.attach({and:{source:F,effect:e=>{var r=y;try{r=effector.scopeBind(y)}catch(e){}return e.listen((()=>{r()})),!0}},or:{name:"subscribeHistoryFx",sid:"-b12mlt"}}),U=effector.sample({and:[{clock:o?[y]:[y,N.done],source:F,filter:Boolean,fn:e=>{var r;return{path:e.location.pathname,query:null!==(r=null==s?void 0:s.read(e.location.search))&&void 0!==r?r:Object.fromEntries(new URLSearchParams(e.location.search))}}}],or:{name:"historyUpdatedParsed",sid:"-rhkauu"}}),H=effector.sample({and:[{clock:U,source:{path:S,query:A},filter:(e,r)=>r.path!==e.path||!c(r.query,e.query),fn:(e,r)=>r}],or:{name:"historyUpdateTriggered",sid:"-pbyg2j"}});F.on(p,((e,r)=>r)),effector.sample({and:[{clock:F,target:N}],or:{sid:"-pwl7u3"}}),effector.sample({and:[{clock:H,source:F,filter:Boolean,fn:e=>{var r,a=null==e?void 0:e.location.hash;return{path:null==e?void 0:e.location.pathname,query:null!==(r=null==s?void 0:s.read(null==e?void 0:e.location.search))&&void 0!==r?r:Object.fromEntries(new URLSearchParams(null==e?void 0:e.location.search)),hash:a}},target:g}],or:{sid:"-ptu8va"}});for(var M,I=i(l);!(M=I()).done;){var L=M.value,Q=j.filterMap(x(L)),B=R.filterMap(x(L)),_={opened:effector.sample({and:[{clock:Q,filter:h(L.route.$isOpened)}],or:{name:"opened",sid:"-vfmdab"}}),updated:effector.sample({and:[{clock:Q,filter:L.route.$isOpened}],or:{name:"updated",sid:"-2uhvx2"}}),closed:effector.sample({and:[{clock:B,filter:L.route.$isOpened}],or:{name:"closed",sid:"jc9588"}})};effector.sample({and:[{clock:_.updated,source:[L.route.$params,L.route.$query],filter:(e,r)=>{var a=e[1];return!c(e[0],r.params)||!c(a,r.query)},fn:(e,r)=>r,target:L.route.updated}],or:{sid:"-ny7ju5"}}),effector.sample({and:[{clock:_.opened,filter:h(z),target:L.route.opened}],or:{sid:"-ngm4ul"}}),effector.sample({and:[{clock:_.closed,target:L.route.closed}],or:{sid:"-d2q1d1"}})}for(var W,K=()=>{var e=W.value;effector.sample({and:[{clock:e.route.navigate.doneData,fn:r=>{var a=r.replace;return{route:e,params:r.params,query:r.query,replace:null!=a&&a}},target:v}],or:{sid:"-cm87k7"}})},G=i(l);!(W=G()).done;)K();z.on(v,(()=>!0)),effector.sample({and:[{clock:v,fn:e=>{var r=e.params,a=e.query,t=e.replace;return{path:f({pathCreator:e.route.path,params:r,query:a,serialize:s}),params:r,query:a,method:t?'replace':'push'}},target:D}],or:{sid:"-c2zeua"}}),z.reset([j,R]),effector.sample({and:[{clock:g,fn:e=>{for(var r,a=e.path,t=e.query,n=e.hash,o=[],c=[],s=i(l);!(r=s()).done;){var d=r.value,u=d.path.includes('#')?""+a+n:""+a,p=m({pathCreator:d.path,actualPath:u});(p.matches?o:c).push({routeObj:d,params:p.params,query:t})}return c.forEach(((e,r)=>{o.some((r=>r.routeObj.route===e.routeObj.route))&&c.splice(r,1)})),{matching:o,mismatching:c.filter(Boolean),path:a,query:t}},target:q}],or:{sid:"-ar5b7v"}}),S.on(H,((e,r)=>r.path)),A.on(H,((e,r)=>r.query));var J=q.map((e=>e.matching));return effector.sample({and:[{clock:J,filter:e=>e.length>0,target:j}],or:{sid:"1l4g7x"}}),effector.sample({and:[{clock:q.map((e=>e.mismatching)),filter:e=>e.length>0,target:R}],or:{sid:"1zyw8o"}}),T.on(q,((e,r)=>r.matching.map((e=>e.routeObj.route)))),effector.sample({and:[{clock:J,filter:e=>0===e.length,target:$}],or:{sid:"2hkb88"}}),effector.withFactory({sid:"2kv2vu",fn:()=>O(n),name:"none",method:"isRoute"})&&(effector.sample({and:[{clock:$,source:A,filter:n.$isOpened,fn:e=>({query:e,params:{}}),target:n.updated}],or:{sid:"2levfh"}}),effector.sample({and:[{clock:$,source:{query:A,isOpened:n.$isOpened},filter:e=>!e.isOpened,fn:e=>({query:e.query,params:{}}),target:n.opened}],or:{sid:"31cwmy"}}),effector.sample({and:[{clock:J,source:n.$isOpened,filter:(e,r)=>e&&r.length>0,target:n.closed}],or:{sid:"3haxuf"}})),effector.sample({and:[{clock:u.back,source:F,target:E}],or:{sid:"3xsrlj"}}),effector.sample({and:[{clock:u.forward,source:F,target:k}],or:{sid:"413j5p"}}),effector.sample({and:[{clock:A,source:{controlsQuery:u.$query,localQuery:A},filter:e=>!c(e.controlsQuery,e.localQuery),fn:e=>e.localQuery,target:u.$query}],or:{sid:"4ghrrt"}}),effector.sample({and:[{clock:u.$query,source:{path:S,localQuery:A,isNavigateInProgress:z,realHistory:F},filter:(e,r)=>{var a,t,n,o=e.localQuery,i=e.isNavigateInProgress,d=e.realHistory,u=null!==(a=null==s?void 0:s.read(null!==(t=null==d?void 0:d.location.search)&&void 0!==t?t:''))&&void 0!==a?a:Object.fromEntries(new URLSearchParams(null!==(n=null==d?void 0:d.location.search)&&void 0!==n?n:''));return i||!c(r,u)||!c(o,r)},fn:(e,r)=>{var a,t=e.path,n=null!==(a=null==s?void 0:s.write(r))&&void 0!==a?a:new URLSearchParams(r);return{path:t+(n?"?"+n:''),params:{},query:r,method:'push'}},target:D}],or:{sid:"4wzlkn"}}),effector.sample({and:[{clock:q,source:{activeRoutes:T,path:S,query:A},filter:C.map((e=>!e)),target:P}],or:{sid:"gbpwte"}}),C.on(P,(()=>!0)).reset(F),{$path:S,$activeRoutes:T,$history:F,setHistory:p,$query:A,back:u.back,forward:u.forward,push:D,routes:l,initialized:P,routeNotFound:$}},e.createRoute=r,e.createRouterControls=b,e.isRoute=O,e.matchPath=m,e.querySync=e=>{var r,a,n,o=null!==(r=null===(a=e.route)||void 0===a?void 0:a.$isOpened)&&void 0!==r?r:effector.createStore(!0,{name:"$isOpened",sid:"-ubx3p"}),c=effector.combine({and:[e.source],or:{name:"$source",sid:"-3rrhte"}}),s=null!==(n=e.clock)&&void 0!==n?n:c,d='cleanup'in e?'boolean'==typeof e.cleanup?q[e.cleanup?'all':'none']:t(t({},q.default),e.cleanup):q.default,u=effector.sample({and:[{clock:e.controls.$query,filter:o}],or:{name:"queryUpdatedFromHistory",sid:"8lf3wv"}});effector.sample({and:[{clock:s,source:effector.combine({and:[[c,e.controls.$query]],or:{name:"source",sid:"-3pgs50"}}),filter:o,fn:e=>{var r=e[0],a=e[1],n={};if(d.irrelevant)for(var o,c=i(d.preserve);!(o=c()).done;){var s=o.value;s in a&&(n[s]=a[s])}else n=t({},a);for(var u in r)n[u]=r[u];if(d.empty)for(var l in r)d.preserve.includes(l)||n[l]||delete n[l];return n},target:e.controls.$query}],or:{sid:"fuzb5g"}});var l=r=>{var a=e.source[r];a.on(u,((e,t)=>{var n;return null!==(n=t[r])&&void 0!==n?n:a.defaultState}))};for(var p in e.source)l(p)},e.redirect=e=>{var r=e.clock?effector.sample({and:[{clock:e.clock}],or:{name:"clock",sid:"-ek44ri"}}):effector.createEvent({name:"clock",sid:"-ejkc65"}),a=y(e.params||{}),t=y(e.query||{}),n=y(e.replace||!1);return effector.sample({and:[{clock:r,source:{params:a,query:t,replace:n},fn:(e,r)=>{var a=e.params,t=e.query,n=e.replace;return{params:'function'==typeof a?a(r):a,query:'function'==typeof t?t(r):t,replace:'function'==typeof n?n(r):n}},target:e.route.navigate}],or:{sid:"ai8jf5"}}),r},Object.defineProperty(e,'__esModule',{value:!0})}));
//# sourceMappingURL=atomic-router.umd.js.map
