function e(e){void 0===e&&(e={});var r=v((e=>{var r=e.replace;return{params:e.params||{},query:e.query||{},replace:void 0!==r&&r}}),{name:"navigateFx",sid:"c2qlao"}),a=y({and:{effect:r,mapParams:e=>({params:e||{},query:{}})},or:{name:"openFx",sid:"am04as"}}),n=g(!1,{name:"$isOpened",sid:"-8u29di"}),t=g({},{name:"$params",sid:"6sxdf"}),o=g({},{name:"$query",sid:"tylje5"}),i=b({name:"opened",sid:"fafqk0"}),s=b({name:"updated",sid:"66vs1s"}),d=b({name:"closed",sid:"-wbq1n3"});return n.on(i,(()=>!0)).on(d,(()=>!1)),t.on(i,((e,r)=>r.params)).on(s,((e,r)=>r.params)),o.on(i,((e,r)=>r.query)).on(s,((e,r)=>r.query)),O({and:[{source:r.doneData,match:n.map((e=>e?'updated':'opened')),cases:{opened:i,updated:s}}],or:{sid:"3j56hf"}}),{$isOpened:n,$params:t,$query:o,opened:i,updated:s,closed:d,navigate:r,open:a,kind:F.ROUTE,settings:{derived:Boolean(e.filter)}}}function r(e,r){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((r=>Object.getOwnPropertyDescriptor(e,r).enumerable))),a.push.apply(a,n)}return a}function a(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?r(Object(t),!0).forEach((r=>{n(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((r=>{Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function n(e,r,a){return r in e?Object.defineProperty(e,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[r]=a,e}function t(e,r){(null==r||r>e.length)&&(r=e.length);for(var a=0,n=new Array(r);a<r;a++)n[a]=e[a];return n}function o(e,r){var it="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(it)return(it=it.call(e)).next.bind(it);if(Array.isArray(e)||(it=((e,r)=>{if(e){if("string"==typeof e)return t(e,r);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?t(e,r):void 0}})(e))||r&&e&&"number"==typeof e.length){it&&(e=it);var a=0;return()=>a>=e.length?{done:!0}:{done:!1,value:e[a++]}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(var a in e)if(""+e[a]!=""+r[a])return!1;return!0}function s(e){var r,a=e.params,n=e.query,t=e.serialize,o=P(e.pathCreator)(a),i=null!==(r=null==t?void 0:t.write(n))&&void 0!==r?r:new URLSearchParams(n);return o+(Object.keys(n).length?"?"+i:'')}function d(e){var r=e.actualPath,a=z(e.pathCreator.replace('://','\\://'))((e=>{if(e.match(/^[a-z0-9]+\:\/\//i))return e;var r=new URL("http://_"+e);return[r.pathname,r.hash].join('')})(r));return a?{matches:!0,params:a.params}:{matches:!1}}function u(e){if(!e)throw new Error('[Routing] No history provided')}function c(e){return e.map((e=>!e))}function l(e){var r=e.base,n=e.routes,t=e.notFoundRoute,u=e.hydrate,l=e.serialize,p=e.controls,m=void 0===p?k({sid:"d2qzob",fn:()=>S(),name:"controls",method:"createRouterControls"}):p,f=((e,r)=>{void 0===r&&(r='');for(var n,t=[],i=()=>{var e,r=n.value;Array.isArray(r.route)?(e=t).push.apply(e,r.route.map((e=>a(a({},r),{},{route:e})))):t.push(r)},s=o(e);!(n=s()).done;)i();t=t.map((e=>a(a({},e),{},{path:""+r+e.path})));for(var d,u=[],c=[],l=o(t);!(d=l()).done;){var p=d.value;p.route.settings.derived?u.push(p):c.push(p)}if(u.length)for(var m,f=o(u);!(m=f()).done;)console.error("createHistoryRouter: "+m.value.path+" uses derived route. This won't work");return c})(n,r),h=b({name:"setHistory",sid:"9zwyxu"}),v=b({name:"navigateFromRouteTriggered",sid:"soge6d"}),O=b({name:"historyUpdated",sid:"-x4474u"}),w=b({name:"recalculateTriggered",sid:"-ykrhlj"}),$=b({name:"recalculated",sid:"aeh4sf"}),R=b({name:"routesMatched",sid:"2rfqt6"}),x=b({name:"routesMismatched",sid:"71hypl"}),P=b({name:"routeNotFound",sid:"avqxzu"}),z=b({name:"initialized",sid:"du6f0f"}),F=g('',{name:"$path",sid:"wz8cwv"}),C=g({},{and:{name:'historyRouter.$query',updateFilter:(e,r)=>!i(e,r)},name:"$query",sid:"tkdilp"}),H=g([],{and:{serialize:'ignore'},name:"$activeRoutes",sid:"9ljm7u"}),Q=g(null,{and:{serialize:'ignore'},name:"$history",sid:"g4i7nj"}),I=g(!1,{name:"$isFirstCheckPassed",sid:"9r108x"}),L=g(!1,{name:"$isRouteNavigateInProgress",sid:"a1vtrl"}),N=y({and:{source:Q,effect:(e,r)=>E(a({history:e},r))},or:{name:"pushFx",sid:"qm76ov"}}),B=y({and:{source:Q,effect:e=>{var r=O;try{r=q(O)}catch(e){}return e.listen((()=>{r()})),!0}},or:{name:"subscribeHistoryFx",sid:"-b12mlt"}}),M=j({and:[{clock:u?[O]:[O,B.done],source:Q,filter:Boolean,fn:e=>{var r;return{path:e.location.pathname,query:null!==(r=null==l?void 0:l.read(e.location.search))&&void 0!==r?r:Object.fromEntries(new URLSearchParams(e.location.search))}}}],or:{name:"historyUpdatedParsed",sid:"-rhkauu"}}),_=j({and:[{clock:M,source:{path:F,query:C},filter:(e,r)=>r.path!==e.path||!i(r.query,e.query),fn:(e,r)=>r}],or:{name:"historyUpdateTriggered",sid:"-pbyg2j"}});Q.on(h,((e,r)=>r)),j({and:[{clock:Q,target:B}],or:{sid:"-pwl7u3"}}),j({and:[{clock:_,source:Q,filter:Boolean,fn:e=>{var r,a=null==e?void 0:e.location.hash;return{path:null==e?void 0:e.location.pathname,query:null!==(r=null==l?void 0:l.read(null==e?void 0:e.location.search))&&void 0!==r?r:Object.fromEntries(new URLSearchParams(null==e?void 0:e.location.search)),hash:a}},target:w}],or:{sid:"-ptu8va"}});for(var G,J=o(f);!(G=J()).done;){var K=G.value,V=R.filterMap(T(K)),W=x.filterMap(T(K)),X={opened:j({and:[{clock:V,filter:c(K.route.$isOpened)}],or:{name:"opened",sid:"-vfmdab"}}),updated:j({and:[{clock:V,filter:K.route.$isOpened}],or:{name:"updated",sid:"-2uhvx2"}}),closed:j({and:[{clock:W,filter:K.route.$isOpened}],or:{name:"closed",sid:"jc9588"}})};j({and:[{clock:X.updated,source:[K.route.$params,K.route.$query],filter:(e,r)=>{var a=e[1];return!i(e[0],r.params)||!i(a,r.query)},fn:(e,r)=>r,target:K.route.updated}],or:{sid:"-ny7ju5"}}),j({and:[{clock:X.opened,filter:c(L),target:K.route.opened}],or:{sid:"-ngm4ul"}}),j({and:[{clock:X.closed,target:K.route.closed}],or:{sid:"-d2q1d1"}})}for(var Y,Z=()=>{var e=Y.value;j({and:[{clock:e.route.navigate.doneData,fn:r=>{var a=r.replace;return{route:e,params:r.params,query:r.query,replace:null!=a&&a}},target:v}],or:{sid:"-cm87k7"}})},ee=o(f);!(Y=ee()).done;)Z();L.on(v,(()=>!0)),j({and:[{clock:v,fn:e=>{var r=e.params,a=e.query,n=e.replace;return{path:s({pathCreator:e.route.path,params:r,query:a,serialize:l}),params:r,query:a,method:n?'replace':'push'}},target:N}],or:{sid:"-c2zeua"}}),L.reset([R,x]),j({and:[{clock:w,fn:e=>{for(var r,a=e.path,n=e.query,t=e.hash,i=[],s=[],u=o(f);!(r=u()).done;){var c=r.value,l=c.path.includes('#')?""+a+t:""+a,p=d({pathCreator:c.path,actualPath:l});(p.matches?i:s).push({routeObj:c,params:p.params,query:n})}return s.forEach(((e,r)=>{i.some((r=>r.routeObj.route===e.routeObj.route))&&s.splice(r,1)})),{matching:i,mismatching:s.filter(Boolean),path:a,query:n}},target:$}],or:{sid:"-ar5b7v"}}),F.on(_,((e,r)=>r.path)),C.on(_,((e,r)=>r.query));var re=$.map((e=>e.matching));return j({and:[{clock:re,filter:e=>e.length>0,target:R}],or:{sid:"1l4g7x"}}),j({and:[{clock:$.map((e=>e.mismatching)),filter:e=>e.length>0,target:x}],or:{sid:"1zyw8o"}}),H.on($,((e,r)=>r.matching.map((e=>e.routeObj.route)))),j({and:[{clock:re,filter:e=>0===e.length,target:P}],or:{sid:"2hkb88"}}),k({sid:"2kv2vu",fn:()=>U(t),name:"none",method:"isRoute"})&&(j({and:[{clock:P,source:C,filter:t.$isOpened,fn:e=>({query:e,params:{}}),target:t.updated}],or:{sid:"2levfh"}}),j({and:[{clock:P,source:{query:C,isOpened:t.$isOpened},filter:e=>!e.isOpened,fn:e=>({query:e.query,params:{}}),target:t.opened}],or:{sid:"31cwmy"}}),j({and:[{clock:re,source:t.$isOpened,filter:(e,r)=>e&&r.length>0,target:t.closed}],or:{sid:"3haxuf"}})),j({and:[{clock:m.back,source:Q,target:A}],or:{sid:"3xsrlj"}}),j({and:[{clock:m.forward,source:Q,target:D}],or:{sid:"413j5p"}}),j({and:[{clock:C,source:{controlsQuery:m.$query,localQuery:C},filter:e=>!i(e.controlsQuery,e.localQuery),fn:e=>e.localQuery,target:m.$query}],or:{sid:"4ghrrt"}}),j({and:[{clock:m.$query,source:{path:F,localQuery:C,isNavigateInProgress:L,realHistory:Q},filter:(e,r)=>{var a,n,t,o=e.localQuery,s=e.isNavigateInProgress,d=e.realHistory,u=null!==(a=null==l?void 0:l.read(null!==(n=null==d?void 0:d.location.search)&&void 0!==n?n:''))&&void 0!==a?a:Object.fromEntries(new URLSearchParams(null!==(t=null==d?void 0:d.location.search)&&void 0!==t?t:''));return s||!i(r,u)||!i(o,r)},fn:(e,r)=>{var a,n=e.path,t=null!==(a=null==l?void 0:l.write(r))&&void 0!==a?a:new URLSearchParams(r);return{path:n+(t?"?"+t:''),params:{},query:r,method:'push'}},target:N}],or:{sid:"4wzlkn"}}),j({and:[{clock:$,source:{activeRoutes:H,path:F,query:C},filter:I.map((e=>!e)),target:z}],or:{sid:"gbpwte"}}),I.on(z,(()=>!0)).reset(Q),{$path:F,$activeRoutes:H,$history:Q,setHistory:h,$query:C,back:m.back,forward:m.forward,push:N,routes:f,initialized:z,routeNotFound:P}}function p(e){var r=e.clock?j({and:[{clock:e.clock}],or:{name:"clock",sid:"-ek44ri"}}):b({name:"clock",sid:"-ejkc65"}),a=m(e.params||{}),n=m(e.query||{}),t=m(e.replace||!1);return j({and:[{clock:r,source:{params:a,query:n,replace:t},fn:(e,r)=>{var a=e.params,n=e.query,t=e.replace;return{params:'function'==typeof a?a(r):a,query:'function'==typeof n?n(r):n,replace:'function'==typeof t?t(r):t}},target:e.route.navigate}],or:{sid:"ai8jf5"}}),r}function m(e){return w.store(e,{sid:"b1hcct"})?e:g(e,{sid:"-cvms36"})}function f(r){var a=(r=>{var a={};if(k({sid:"-vuorye",fn:()=>U(r),name:"none",method:"isRoute"}))return Object.assign(a,{route:r,chainedRoute:k({sid:"-x3jlk0",fn:()=>e(),name:"chainedRoute",method:"createRoute"}),beforeOpen:b({name:"beforeOpen",sid:"2i9mdy"}),openOn:x([r.opened,r.closed],{name:"openOn",sid:"-n9uh0c"}),cancelOn:x([b({name:"cancelOn",sid:"r6ceph"})],{name:"cancelOn",sid:"r6ce1d"})}),a;var n=r;if(Object.assign(a,{route:n.route,chainedRoute:n.chainedRoute||k({sid:"-if59ok",fn:()=>e(),name:"chainedRoute",method:"createRoute"}),beforeOpen:w.unit(n.beforeOpen)?n.beforeOpen:y({and:n.beforeOpen,or:{name:"beforeOpen",sid:"-xdumjk"}})}),w.effect(a.beforeOpen,{sid:"-qylloz"}))return Object.assign(a,{openOn:n.openOn||a.beforeOpen.doneData,cancelOn:n.cancelOn||a.beforeOpen.failData}),a;var t=r;return Object.assign(a,{openOn:j({and:[{clock:t.openOn}],or:{name:"openOn",sid:"-92mmrn"}}),cancelOn:j({and:[{clock:t.cancelOn||b({name:"clock",sid:"-53qs2n"})}],or:{name:"cancelOn",sid:"-m0jt12"}})}),a})(r),n=a.route,t=a.chainedRoute,o=a.beforeOpen,i=a.openOn,s=a.cancelOn,d=g({},{name:"$params",sid:"ahwukb"}),u=g({},{name:"$query",sid:"-urele3"}),c=$({and:[$({and:[[n.$params,n.$query]],or:{name:"and",sid:"3v6jcf"}}),$({and:[[d,u]],or:{name:"and",sid:"3vqbxs"}}),(e,r)=>e[0]===r[0]&&e[1]===r[1]],or:{name:"$hasSameParams",sid:"-xzy23v"}}),l=j({and:[{clock:[n.opened,n.updated]}],or:{name:"routeOpened",sid:"-gtwxmc"}});j({and:[{clock:l,target:o}],or:{sid:"-noxmt5"}}),d.on(l,((e,r)=>r.params)),u.on(l,((e,r)=>r.query));var p=R({and:[{clock:i,source:{params:d,query:u},filter:c}],or:{name:"chainedRouteResolved",sid:"-mwemeb"}});j({and:[{clock:p,target:t.navigate}],or:{sid:"-n6sf88"}});var m=x([n.closed,s],{name:"aborted",sid:"utn0jm"});return d.reset(m),u.reset(m),j({and:[{clock:m,target:t.closed}],or:{sid:"-mqalfe"}}),t}function h(e){var r,n,t,i=null!==(r=null===(n=e.route)||void 0===n?void 0:n.$isOpened)&&void 0!==r?r:g(!0,{name:"$isOpened",sid:"-ubx3p"}),s=$({and:[e.source],or:{name:"$source",sid:"-3rrhte"}}),d=null!==(t=e.clock)&&void 0!==t?t:s,u='cleanup'in e?'boolean'==typeof e.cleanup?C[e.cleanup?'all':'none']:a(a({},C.default),e.cleanup):C.default,c=j({and:[{clock:e.controls.$query,filter:i}],or:{name:"queryUpdatedFromHistory",sid:"8lf3wv"}});j({and:[{clock:d,source:$({and:[[s,e.controls.$query]],or:{name:"source",sid:"-3pgs50"}}),filter:i,fn:e=>{var r=e[0],n=e[1],t={};if(u.irrelevant)for(var i,s=o(u.preserve);!(i=s()).done;){var d=i.value;d in n&&(t[d]=n[d])}else t=a({},n);for(var c in r)t[c]=r[c];if(u.empty)for(var l in r)u.preserve.includes(l)||t[l]||delete t[l];return t},target:e.controls.$query}],or:{sid:"fuzb5g"}});var l=r=>{var a=e.source[r];a.on(c,((e,n)=>{var t;return null!==(t=n[r])&&void 0!==t?t:a.defaultState}))};for(var p in e.source)l(p)}import{createEffect as v,attach as y,createStore as g,createEvent as b,split as O,withFactory as k,scopeBind as q,sample as j,is as w,combine as $,guard as R,merge as x}from'effector';import{compile as P,match as z}from'path-to-regexp';var F={ROUTE:Symbol()},S=()=>({$query:g({},{and:{updateFilter:(e,r)=>!i(r,e)},name:"$query",sid:"z22f3o"}),back:b({name:"back",sid:"lqciue"}),forward:b({name:"forward",sid:"-5dfdts"})}),U=e=>'object'==typeof e&&null!==e&&'kind'in e&&e.kind===F.ROUTE,E=v((e=>(u(e.history),e.history[e.method](e.path,{}),e)),{name:"historyPushFx",sid:"-w0no5y"}),A=v((e=>(u(e),e.back(),e)),{name:"historyBackFx",sid:"-ny8vwp"}),D=v((e=>(u(e),e.forward(),e)),{name:"historyForwardFx",sid:"88oqi4"}),T=e=>r=>{var a=r.find((r=>r.routeObj.route===e.route));if(a)return{params:a.params,query:a.query}},C={all:{irrelevant:!0,empty:!0,preserve:[]},default:{irrelevant:!1,empty:!0,preserve:[]},none:{irrelevant:!1,empty:!1,preserve:[]}};export{F as Kind,s as buildPath,f as chainRoute,l as createHistoryRouter,e as createRoute,S as createRouterControls,U as isRoute,d as matchPath,h as querySync,p as redirect};
//# sourceMappingURL=atomic-router.esm.js.map
